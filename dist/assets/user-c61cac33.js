/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{q as e,r as a,t as l,v as t,w as u,x as o}from"./index-e8818864.js";import{g as r}from"./authority-268926bd.js";import{C as i}from"./index-2ac7514a.js";import{_ as n,U as d,a as s,g as V,e as c}from"./common-0d5e5220.js";import{W as m}from"./warningBar-4e9b9d77.js";import"./.pnpm-8206d43d.js";import"vue";import"./_plugin-vue_export-helper-1b428a4d.js";const p={class:"gva-btn-list"},v={class:"media"},g={class:"header-img-box-list"},h={class:"header-img-box-list"},y=Vue.createElementVNode("picture",null,null,-1),f=["onClick"],N={__name:"index",props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(e,{expose:a,emit:l}){const t=Vue.ref(""),u=Vue.ref(""),o=Vue.ref({}),r=Vue.ref(1),i=Vue.ref(0),N=Vue.ref(20),w=e=>{N.value=e,k()},C=e=>{r.value=e,k()},x=Vue.ref(!1),b=Vue.ref([]),k=async()=>{const e=await V({page:r.value,pageSize:N.value,...o.value});0===e.code&&(b.value=e.data.list,i.value=e.data.total,r.value=e.data.page,N.value=e.data.pageSize,x.value=!0)};return a({open:k}),(a,V)=>{const I=Vue.resolveComponent("el-input"),E=Vue.resolveComponent("el-form-item"),_=Vue.resolveComponent("el-button"),B=Vue.resolveComponent("el-form"),U=Vue.resolveComponent("el-icon"),z=Vue.resolveComponent("el-image"),S=Vue.resolveComponent("el-pagination"),T=Vue.resolveComponent("el-drawer");return Vue.openBlock(),Vue.createBlock(T,{modelValue:x.value,"onUpdate:modelValue":V[3]||(V[3]=e=>x.value=e),title:"媒体库",size:"650px"},{default:Vue.withCtx((()=>[Vue.createVNode(m,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),Vue.createElementVNode("div",p,[Vue.createVNode(n,{imageCommon:u.value,"onUpdate:imageCommon":V[0]||(V[0]=e=>u.value=e),class:"upload-btn-media-library",onOnSuccess:k},null,8,["imageCommon"]),Vue.createVNode(d,{imageUrl:t.value,"onUpdate:imageUrl":V[1]||(V[1]=e=>t.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:k},null,8,["imageUrl"]),Vue.createVNode(B,{ref:"searchForm",inline:!0,model:o.value},{default:Vue.withCtx((()=>[Vue.createVNode(E,{label:""},{default:Vue.withCtx((()=>[Vue.createVNode(I,{modelValue:o.value.keyword,"onUpdate:modelValue":V[2]||(V[2]=e=>o.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),Vue.createVNode(E,null,{default:Vue.withCtx((()=>[Vue.createVNode(_,{type:"primary",icon:"search",onClick:k},{default:Vue.withCtx((()=>[Vue.createTextVNode("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),Vue.createElementVNode("div",v,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,((a,t)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:t,class:"media-box"},[Vue.createElementVNode("div",g,[(Vue.openBlock(),Vue.createBlock(z,{key:t,src:Vue.unref(s)(a.url),onClick:t=>{return u=a.url,o=e.target,r=e.targetKey,o&&r&&(o[r]=u),l("enterImg",u),void(x.value=!1);var u,o,r}},{error:Vue.withCtx((()=>[Vue.createElementVNode("div",h,[Vue.createVNode(U,null,{default:Vue.withCtx((()=>[y])),_:1})])])),_:2},1032,["src","onClick"]))]),Vue.createElementVNode("div",{class:"img-title",onClick:e=>(async e=>{ElementPlus.ElMessageBox.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await c(e)).code&&(ElementPlus.ElMessage({type:"success",message:"编辑成功!"}),k())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"取消修改"})}))})(a)},Vue.toDisplayString(a.name),9,f)])))),128))]),Vue.createVNode(S,{"current-page":r.value,"page-size":N.value,total:i.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:C,onSizeChange:w},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}},w={class:"gva-table-box"},C={class:"gva-btn-list"},x=Vue.createElementVNode("p",null,"确定要删除此用户吗",-1),b={style:{"text-align":"right","margin-top":"8px"}},k={class:"gva-pagination"},I={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},E=["src"],_={key:1,class:"header-img-box"},B={class:"dialog-footer"},U=Object.assign({name:"User"},{__name:"user",setup(n){const d=Vue.ref("/api/"),s=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};s(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},V=Vue.ref(1),c=Vue.ref(0),p=Vue.ref(10),v=Vue.ref([]),g=e=>{p.value=e,y()},h=e=>{V.value=e,y()},y=async()=>{const a=await e({page:V.value,pageSize:p.value});0===a.code&&(v.value=a.data.list,c.value=a.data.total,V.value=a.data.page,p.value=a.data.pageSize)};Vue.watch((()=>v.value),(()=>{f()}));(async()=>{y();const e=await r({page:1,pageSize:999});T(e.data.list)})();const f=()=>{v.value&&v.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},U=Vue.ref(null),z=()=>{U.value.open()},S=Vue.ref([]),T=e=>{S.value=[],s(e,S.value)},M=Vue.ref({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1,concurrencyLimit:0,currentConcurrency:0}),P=Vue.ref({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),j=Vue.ref(null),D=async()=>{M.value.authorityId=M.value.authorityIds[0],j.value.validate((async e=>{if(e){const e={...M.value};if("add"===q.value){0===(await t(e)).code&&(ElementPlus.ElMessage({type:"success",message:"创建成功"}),await y(),L())}if("edit"===q.value){0===(await u(e)).code&&(ElementPlus.ElMessage({type:"success",message:"编辑成功"}),await y(),L())}}}))},O=Vue.ref(!1),L=()=>{j.value.resetFields(),M.value.headerImg="",M.value.authorityIds=[],O.value=!1},q=Vue.ref("add"),F=()=>{q.value="add",O.value=!0},J={},K=async(e,a,l)=>{if(a)return void(l||(J[e.ID]=[...e.authorityIds]));await Vue.nextTick();0===(await o({ID:e.ID,authorityIds:e.authorityIds})).code?ElementPlus.ElMessage({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...J[e.ID]],delete J[e.ID])};return(e,t)=>{const o=Vue.resolveComponent("el-button"),r=Vue.resolveComponent("el-table-column"),n=Vue.resolveComponent("el-cascader"),s=Vue.resolveComponent("el-switch"),f=Vue.resolveComponent("el-popover"),T=Vue.resolveComponent("el-table"),J=Vue.resolveComponent("el-pagination"),R=Vue.resolveComponent("el-input"),$=Vue.resolveComponent("el-form-item"),A=Vue.resolveComponent("el-form"),W=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(m,{title:"注：右上角头像下拉可切换角色"}),Vue.createElementVNode("div",w,[Vue.createElementVNode("div",C,[Vue.createVNode(o,{type:"primary",icon:"plus",onClick:F},{default:Vue.withCtx((()=>[Vue.createTextVNode("新增用户")])),_:1})]),Vue.createVNode(T,{data:v.value,"row-key":"ID"},{default:Vue.withCtx((()=>[Vue.createVNode(r,{align:"left",label:"头像","min-width":"75"},{default:Vue.withCtx((e=>[Vue.createVNode(i,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),Vue.createVNode(r,{align:"left",label:"ID","min-width":"50",prop:"ID"}),Vue.createVNode(r,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),Vue.createVNode(r,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),Vue.createVNode(r,{align:"left",label:"并发数限制","min-width":"150",prop:"concurrencyLimit"}),Vue.createVNode(r,{align:"left",label:"当前并发数","min-width":"150",prop:"currentConcurrency"}),Vue.createVNode(r,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),Vue.createVNode(r,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),Vue.createVNode(r,{align:"left",label:"用户角色","min-width":"200"},{default:Vue.withCtx((e=>[Vue.createVNode(n,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:S.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{K(e.row,a,0)},onRemoveTag:a=>{K(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),Vue.createVNode(r,{align:"left",label:"启用","min-width":"150"},{default:Vue.withCtx((e=>[Vue.createVNode(s,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{M.value=JSON.parse(JSON.stringify(e)),await Vue.nextTick();const a={...M.value};0===(await u(a)).code&&(ElementPlus.ElMessage({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await y(),M.value.headerImg="",M.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),Vue.createVNode(r,{label:"操作","min-width":"250",fixed:"right"},{default:Vue.withCtx((e=>[Vue.createVNode(f,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top",width:"160"},{reference:Vue.withCtx((()=>[Vue.createVNode(o,{type:"primary",link:"",icon:"delete"},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:1})])),default:Vue.withCtx((()=>[x,Vue.createElementVNode("div",b,[Vue.createVNode(o,{type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:Vue.withCtx((()=>[Vue.createTextVNode("取消")])),_:2},1032,["onClick"]),Vue.createVNode(o,{type:"primary",onClick:a=>(async e=>{0===(await l({id:e.ID})).code&&(ElementPlus.ElMessage.success("删除成功"),e.visible=!1,await y())})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"]),Vue.createVNode(o,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,q.value="edit",M.value=JSON.parse(JSON.stringify(l)),void(O.value=!0);var l}},{default:Vue.withCtx((()=>[Vue.createTextVNode("编辑")])),_:2},1032,["onClick"]),Vue.createVNode(o,{type:"primary",link:"",icon:"magic-stick",onClick:l=>{return t=e.row,void ElementPlus.ElMessageBox.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await a({ID:t.ID});0===e.code?ElementPlus.ElMessage({type:"success",message:e.msg}):ElementPlus.ElMessage({type:"error",message:e.msg})}));var t}},{default:Vue.withCtx((()=>[Vue.createTextVNode("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),Vue.createElementVNode("div",k,[Vue.createVNode(J,{"current-page":V.value,"page-size":p.value,"page-sizes":[10,30,50,100],total:c.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:h,onSizeChange:g},null,8,["current-page","page-size","total"])])]),Vue.createVNode(W,{modelValue:O.value,"onUpdate:modelValue":t[9]||(t[9]=e=>O.value=e),title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",B,[Vue.createVNode(o,{onClick:L},{default:Vue.withCtx((()=>[Vue.createTextVNode("取 消")])),_:1}),Vue.createVNode(o,{type:"primary",onClick:D},{default:Vue.withCtx((()=>[Vue.createTextVNode("确 定")])),_:1})])])),default:Vue.withCtx((()=>[Vue.createElementVNode("div",I,[Vue.createVNode(A,{ref_key:"userForm",ref:j,rules:P.value,model:M.value,"label-width":"80px"},{default:Vue.withCtx((()=>["add"===q.value?(Vue.openBlock(),Vue.createBlock($,{key:0,label:"用户名",prop:"userName"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.userName,"onUpdate:modelValue":t[0]||(t[0]=e=>M.value.userName=e)},null,8,["modelValue"])])),_:1})):Vue.createCommentVNode("",!0),"add"===q.value?(Vue.openBlock(),Vue.createBlock($,{key:1,label:"密码",prop:"password"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.password,"onUpdate:modelValue":t[1]||(t[1]=e=>M.value.password=e)},null,8,["modelValue"])])),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode($,{label:"昵称",prop:"nickName"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.nickName,"onUpdate:modelValue":t[2]||(t[2]=e=>M.value.nickName=e)},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"手机号",prop:"phone"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>M.value.phone=e)},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"邮箱",prop:"email"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.email,"onUpdate:modelValue":t[4]||(t[4]=e=>M.value.email=e)},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"并发限制",prop:"concurrencyLimit"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.concurrencyLimit,"onUpdate:modelValue":t[5]||(t[5]=e=>M.value.concurrencyLimit=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"当前使用并发数",prop:"currentConcurrency"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{modelValue:M.value.currentConcurrency,"onUpdate:modelValue":t[6]||(t[6]=e=>M.value.currentConcurrency=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"用户角色",prop:"authorityId"},{default:Vue.withCtx((()=>[Vue.createVNode(n,{modelValue:M.value.authorityIds,"onUpdate:modelValue":t[7]||(t[7]=e=>M.value.authorityIds=e),style:{width:"100%"},options:S.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),Vue.createVNode($,{label:"启用",prop:"disabled"},{default:Vue.withCtx((()=>[Vue.createVNode(s,{modelValue:M.value.enable,"onUpdate:modelValue":t[8]||(t[8]=e=>M.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),Vue.createVNode($,{label:"头像","label-width":"80px"},{default:Vue.withCtx((()=>[Vue.createElementVNode("div",{style:{display:"inline-block"},onClick:z},[M.value.headerImg?(Vue.openBlock(),Vue.createElementBlock("img",{key:0,alt:"头像",class:"header-img-box",src:M.value.headerImg&&"http"!==M.value.headerImg.slice(0,4)?d.value+M.value.headerImg:M.value.headerImg},null,8,E)):(Vue.openBlock(),Vue.createElementBlock("div",_,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),Vue.createVNode(N,{ref_key:"chooseImg",ref:U,target:M.value,"target-key":"headerImg"},null,8,["target"])])}}});export{U as default};
