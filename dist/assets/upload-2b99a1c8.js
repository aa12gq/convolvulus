/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{_ as e,U as t,g as a,d as l,e as o}from"./common-0d5e5220.js";import{C as n}from"./index-2ac7514a.js";import{f as u}from"./format-7fc9107b.js";import{W as r}from"./warningBar-4e9b9d77.js";import{_ as i}from"./_plugin-vue_export-helper-1b428a4d.js";import"./index-e8818864.js";import"./.pnpm-8206d43d.js";import"vue";import"./date-8358c12f.js";import"./dictionary-b8ecc85f.js";import"./sysDictionary-30d98c9c.js";const s=(e,t)=>{var a=new Image;a.setAttribute("crossOrigin","anonymous"),a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0,a.width,a.height);var l=e.toDataURL("image/png"),o=document.createElement("a"),n=new MouseEvent("click");o.download=t||"photo",o.href=l,o.dispatchEvent(n)},a.src=e},c={class:"gva-table-box"},d={class:"gva-btn-list"},p=["onClick"],V={class:"gva-pagination"},m=i(Object.assign({name:"Upload"},{__name:"upload",setup(i){const m=Vue.ref("/api"),g=Vue.ref(""),v=Vue.ref(""),f=Vue.ref(1),h=Vue.ref(0),w=Vue.ref(10),y=Vue.ref({}),x=Vue.ref([]),C=e=>{w.value=e,E()},N=e=>{f.value=e,E()},E=async()=>{const e=await a({page:f.value,pageSize:w.value,...y.value});0===e.code&&(x.value=e.data.list,h.value=e.data.total,f.value=e.data.page,w.value=e.data.pageSize)};E();return(a,i)=>{const _=Vue.resolveComponent("el-input"),b=Vue.resolveComponent("el-button"),k=Vue.resolveComponent("el-table-column"),j=Vue.resolveComponent("el-tag"),U=Vue.resolveComponent("el-table"),B=Vue.resolveComponent("el-pagination"),S=Vue.resolveDirective("loading");return Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",c,[Vue.createVNode(r,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),Vue.createElementVNode("div",d,[Vue.createVNode(e,{imageCommon:v.value,"onUpdate:imageCommon":i[0]||(i[0]=e=>v.value=e),onOnSuccess:E},null,8,["imageCommon"]),Vue.createVNode(t,{imageUrl:g.value,"onUpdate:imageUrl":i[1]||(i[1]=e=>g.value=e),"file-size":512,"max-w-h":1080,onOnSuccess:E},null,8,["imageUrl"]),Vue.createVNode(_,{modelValue:y.value.keyword,"onUpdate:modelValue":i[2]||(i[2]=e=>y.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"]),Vue.createVNode(b,{type:"primary",icon:"search",onClick:E},{default:Vue.withCtx((()=>[Vue.createTextVNode("查询")])),_:1})]),Vue.createVNode(U,{data:x.value},{default:Vue.withCtx((()=>[Vue.createVNode(k,{align:"left",label:"预览",width:"100"},{default:Vue.withCtx((e=>[Vue.createVNode(n,{"pic-type":"file","pic-src":e.row.url,preview:""},null,8,["pic-src"])])),_:1}),Vue.createVNode(k,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:Vue.withCtx((e=>[Vue.createElementVNode("div",null,Vue.toDisplayString(Vue.unref(u)(e.row.UpdatedAt)),1)])),_:1}),Vue.createVNode(k,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:Vue.withCtx((e=>[Vue.createElementVNode("div",{class:"name",onClick:t=>(async e=>{ElementPlus.ElMessageBox.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:t})=>{e.name=t,0===(await o(e)).code&&(ElementPlus.ElMessage({type:"success",message:"编辑成功!"}),E())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"取消修改"})}))})(e.row)},Vue.toDisplayString(e.row.name),9,p)])),_:1}),Vue.createVNode(k,{align:"left",label:"链接",prop:"url","min-width":"300"}),Vue.createVNode(k,{align:"left",label:"标签",prop:"tag",width:"100"},{default:Vue.withCtx((e=>[Vue.createVNode(j,{type:"jpg"===e.row.tag?"primary":"success","disable-transitions":""},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(e.row.tag),1)])),_:2},1032,["type"])])),_:1}),Vue.createVNode(k,{align:"left",label:"操作",width:"160"},{default:Vue.withCtx((e=>[Vue.createVNode(b,{icon:"download",type:"primary",link:"",onClick:t=>{var a;(a=e.row).url.indexOf("http://")>-1||a.url.indexOf("https://")>-1?s(a.url,a.name):s(m.value+"/"+a.url,a.name)}},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载")])),_:2},1032,["onClick"]),Vue.createVNode(b,{icon:"delete",type:"primary",link:"",onClick:t=>(async e=>{ElementPlus.ElMessageBox.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await l(e)).code&&(ElementPlus.ElMessage({type:"success",message:"删除成功!"}),1===x.value.length&&f.value>1&&f.value--,E())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"已取消删除"})}))})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),Vue.createElementVNode("div",V,[Vue.createVNode(B,{"current-page":f.value,"page-size":w.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:h.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:N,onSizeChange:C},null,8,["current-page","page-size","total"])])])])),[[S,a.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-de65f0f5"]]);export{m as default};
