/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{g as e,d as t,P as a,R as l,c as u,D as o,a as r,b as n,e as c,f as i,h as s,i as d,j as V}from"./registerTask-73d20a44.js";import{g as m}from"./country-ad958732.js";import{W as p}from"./warningBar-4e9b9d77.js";import{h as f}from"./index-e8818864.js";import{g}from"./accoutTag-cc78c789.js";import{g as w}from"./accoutGroup-00835702.js";import"./.pnpm-8206d43d.js";import"vue";const h={class:"authority"},x={class:"gva-table-box"},C={class:"gva-btn-list"},N=Vue.createElementVNode("br",null,null,-1),v=Vue.createElementVNode("br",null,null,-1),y={class:"button-group"},k={class:"text-sm text-orange-300 mt-2"},_={key:0},b=Object.assign({name:"Register"},{__name:"index",setup(b){const E=e=>{e()},T=Vue.ref(!1),B=Vue.ref(1),P=Vue.ref(0),D=Vue.ref(10),R=Vue.ref([]),M=Vue.ref(""),I=Vue.ref(""),S=Vue.ref(!1),j=e=>{B.value=e,U()},z=e=>{D.value=e,U()};Vue.watch((()=>T.value),(e=>{e&&J()}));const F=Vue.ref({concurrencyLimit:0,currentConcurrency:0}),A=async()=>{S.value=!0;const e=await f();F.value=e.data,setTimeout((()=>{S.value=!1}),1e3)},U=async(t,a)=>{const l=await e({page:B.value,pageSize:D.value,taskName:I.value,sort:t,order:a});0===l.code&&(R.value=[],setTimeout((()=>{R.value=l.data.list}),100),P.value=l.data.total,B.value=l.data.page,D.value=l.data.pageSize)};U();const L=e=>{switch(e){case"Pending":return"等待";case"Success":return"已成功";case"Failed":return"失败";case"Running":return"运行中";case"Pause":return"已暂停";default:return""}},q=e=>{switch(e){case"Pending":return"warning";case"Success":return"success";case"Failed":case"Pause":return"danger";case"Running":return"info";default:return""}},O=e=>{switch(e){case"Pending":return"el-icon-clock";case"Success":return"CircleCheck";case"Failed":return"el-icon-circle-close";case"Running":return"el-icon-loading";case"Pause":return"VideoPlay";default:return""}},G=Vue.ref(null),W=Vue.ref([]),$=(e,t)=>{W.value=t,t.length>0?H.file=t[0].raw:H.file=null},H=Vue.reactive({taskName:"",country_id:null,concurrency:1,file:null,tag_id:null,immediate:!0,group_id:null}),J=()=>{Vue.nextTick((()=>{Form.value?Form.value.resetFields():console.error("The form reference 'Form' is not available.")})),ae(),ee(),ue(),H.value={taskName:"",country:null,concurrency:1,file:null,tag_id:null,immediate:!0,group_id:null}},K={taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],file:[{required:!0,message:"请上传文件",trigger:"change"}],countryCode:[{required:!0,message:"请选择国家区号",trigger:"change"}],concurrency:[{required:!0,message:"请输入并发数",trigger:"blur"},{type:"number",message:"并发数必须为数字值",trigger:"blur"}]},Q=async()=>{if(!(await G.value.validate()))return;const e=new FormData;e.append("taskName",H.taskName),e.append("country_id",H.country_id),e.append("concurrency",H.concurrency),e.append("tag_id",H.tag_id),e.append("group_id",H.group_id),e.append("immediate",H.immediate),H.file&&e.append("file",H.file,H.file.name);try{0===(await u(e)).code&&(ElementPlus.ElMessage.success("创建成功！"),setTimeout((()=>{U()}),500))}catch(t){ElementPlus.ElMessage.error(t.message||"创建任务失败")}},X=()=>{G.value&&G.value.resetFields()},Y=async(e,t,a,l=3e3)=>{try{ElementPlus.ElMessage.info("准备下载，请稍候...");const u=await e(t.ID);if(u&&u.data){"开始下载 ".concat(a);const e=new Blob([u.data],{type:"text/plain"});setTimeout((()=>{const t=window.URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.setAttribute("download",a),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t),ElementPlus.ElMessage.success("下载成功")}),l)}else ElementPlus.ElMessage.error("下载 ".concat(a," 失败：没有数据返回"))}catch(u){ElementPlus.ElMessage.error("下载出错"),console.error("下载出错",u)}},Z=Vue.ref([]),ee=async()=>{const e=await w(1,100);0===e.code&&Array.isArray(e.data.list)&&(Z.value=[],setTimeout((()=>{Z.value=e.data.list}),100),P.value=e.data.total,B.value=e.data.page,D.value=e.data.pageSize)},te=Vue.ref([]),ae=async()=>{const e=await g(1,100);0===e.code&&(te.value=[],setTimeout((()=>{te.value=e.data.list}),100),P.value=e.data.total,B.value=e.data.page,D.value=e.data.pageSize)},le=Vue.ref([]),ue=async()=>{const e=await m(1,300);0===e.code&&Array.isArray(e.data.list)&&(le.value=[],setTimeout((()=>{le.value=e.data.list}),100),P.value=e.data.total,B.value=e.data.page,D.value=e.data.pageSize)},oe=Vue.ref(null),re=Vue.ref([]),ne=e=>{re.value=e};return(e,u)=>{const m=Vue.resolveComponent("el-input"),f=Vue.resolveComponent("el-button"),g=Vue.resolveComponent("el-tooltip"),w=Vue.resolveComponent("el-table-column"),b=Vue.resolveComponent("el-dropdown-item"),I=Vue.resolveComponent("el-dropdown-menu"),J=Vue.resolveComponent("el-dropdown"),ee=Vue.resolveComponent("el-table"),ae=Vue.resolveComponent("el-pagination"),ue=Vue.resolveComponent("el-form-item"),ce=Vue.resolveComponent("el-option"),ie=Vue.resolveComponent("el-select"),se=Vue.resolveComponent("Refresh"),de=Vue.resolveComponent("el-icon"),Ve=Vue.resolveComponent("el-col"),me=Vue.resolveComponent("el-row"),pe=Vue.resolveComponent("el-upload"),fe=Vue.resolveComponent("el-form"),ge=Vue.resolveComponent("el-drawer");return Vue.openBlock(),Vue.createElementBlock("div",h,[Vue.createVNode(p,{title:"注：账号批量注册"}),Vue.createElementVNode("div",x,[Vue.createElementVNode("div",C,[Vue.createVNode(m,{modelValue:M.value,"onUpdate:modelValue":u[0]||(u[0]=e=>M.value=e),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),Vue.createVNode(f,{type:"primary",icon:"Search"},{default:Vue.withCtx((()=>[Vue.createTextVNode("搜索")])),_:1}),Vue.createVNode(f,{type:"primary",icon:"CirclePlus",onClick:u[1]||(u[1]=()=>{T.value=!0,A()})},{default:Vue.withCtx((()=>[Vue.createTextVNode("新建任务")])),_:1}),Vue.createVNode(g,{placement:"top"},{content:Vue.withCtx((()=>[Vue.createTextVNode(" 选择任一任务并暂停。请注意，发送暂停信号后可能会有短暂延迟才能完全停止"),N])),default:Vue.withCtx((()=>[Vue.createVNode(f,{icon:"Bell",type:"primary",disabled:1!=re.value.length,onClick:u[2]||(u[2]=e=>(1!==re.value.length&&ElementPlus.ElMessage({type:"info",message:"目前暂停任务只支持单个任务进行暂停"}),void ElementPlus.ElMessageBox.confirm("此操作将暂停该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await a(re.value[0].ID);0!==e.code&&null!=e||(ElementPlus.ElMessage({type:"success",message:"任务暂停成功 !"}),U(),R.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"已取消暂停"})}))))},{default:Vue.withCtx((()=>[Vue.createTextVNode("暂停任务")])),_:1},8,["disabled"])])),_:1}),Vue.createVNode(g,{placement:"top"},{content:Vue.withCtx((()=>[Vue.createTextVNode(" 选择任一已暂停任务。请注意，发送恢复信号后可能会有短暂延迟才能完全停止"),v])),default:Vue.withCtx((()=>[Vue.createVNode(f,{icon:"Bell",type:"primary",disabled:1!=re.value.length,onClick:u[3]||(u[3]=e=>(1!==re.value.length&&ElementPlus.ElMessage({type:"info",message:"目前恢复任务只支持单个任务进行恢复"}),void ElementPlus.ElMessageBox.confirm("您确定要恢复该任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await l(re.value[0].ID)).code&&(ElementPlus.ElMessage({type:"success",message:"任务恢复成功 !"}),U(),R.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"已取消恢复任务"})}))))},{default:Vue.withCtx((()=>[Vue.createTextVNode("恢复任务")])),_:1},8,["disabled"])])),_:1}),Vue.createVNode(f,{type:"primary",icon:"refresh",onClick:u[4]||(u[4]=e=>U())},{default:Vue.withCtx((()=>[Vue.createTextVNode("刷新")])),_:1}),Vue.createVNode(g,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"}),Vue.createVNode(g,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"}),Vue.createVNode(g,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"})]),Vue.createVNode(ee,{ref_key:"multipleTableRef",ref:oe,data:R.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"},onSelectionChange:ne},{default:Vue.withCtx((()=>[Vue.createVNode(w,{type:"selection",width:"55"}),Vue.createVNode(w,{label:"ID","min-width":"180",prop:"ID"}),Vue.createVNode(w,{align:"left",label:"任务名称","min-width":"180",prop:"task_name"}),Vue.createVNode(w,{align:"left",label:"文件名称","min-width":"180",prop:"file_name"}),Vue.createVNode(w,{align:"left",label:"任务状态","min-width":"180"},{default:Vue.withCtx((({row:e})=>[Vue.createVNode(f,{type:q(e.status),size:"small",loading:"Running"==e.status,icon:O(e.status),plain:""},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(L(e.status)),1)])),_:2},1032,["type","loading","icon"])])),_:1}),Vue.createVNode(w,{align:"left",label:"并发数","min-width":"180",prop:"concurrency"}),Vue.createVNode(w,{align:"left",label:"成功","min-width":"180",prop:"success_count"}),Vue.createVNode(w,{align:"left",label:"封号","min-width":"180",prop:"blocked_count"}),Vue.createVNode(w,{align:"left",label:"风控1小时","min-width":"180"},{default:Vue.withCtx((e=>[Vue.createTextVNode(Vue.toDisplayString(e.row.no_routes_count+e.row.too_recent_count),1)])),_:1}),Vue.createVNode(w,{align:"left",label:"非官方","min-width":"180",prop:"office_count"}),Vue.createVNode(w,{align:"left",label:"总数","min-width":"180",prop:"totalNumber"}),Vue.createVNode(w,{align:"left",label:"创建时间","min-width":"180",prop:"formattedCreatedAt"}),Vue.createVNode(w,{align:"left",label:"更新时间","min-width":"180",prop:"formattedUpdatedAt"}),Vue.createVNode(w,{align:"left",label:"操作",width:"260",fixed:"right"},{default:Vue.withCtx((a=>[Vue.createElementVNode("div",y,[Vue.createVNode(f,{icon:"Files",type:"primary",link:"",onClick:t=>e.$router.push({name:"subtask",params:{id:a.row.ID}})},{default:Vue.withCtx((()=>[Vue.createTextVNode("详情")])),_:2},1032,["onClick"]),Vue.createVNode(f,{icon:"delete",type:"primary",link:"",disabled:"Running"==a.row.status,onClick:e=>{return l=a.row,void ElementPlus.ElMessageBox.confirm("此操作将永久删除该任务及相关账号, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await t({ID:l.ID});0!==e.code&&null!=e||(ElementPlus.ElMessage({type:"success",message:"任务删除成功 !"}),1===R.value.length&&B.value>1&&B.value--,U(),R.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"已取消删除"})}));var l}},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:2},1032,["disabled","onClick"]),Vue.createVNode(J,{trigger:"click",class:"el-button-like"},{dropdown:Vue.withCtx((()=>[Vue.createVNode(I,null,{default:Vue.withCtx((()=>[a.row.nonDisabledAccounts>0&&a.row.DisabledAccounts>0?(Vue.openBlock(),Vue.createBlock(b,{key:0},{default:Vue.withCtx((()=>[Vue.createTextVNode("什么都没有")])),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(d,e,"未执行账号.txt")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载未执行账号(txt)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(V,e,"未执行账号.xlsx")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载未执行账号(excel)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(o,e,"封锁账号.txt")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载封号账号(txt)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(r,e,"封锁账号.xlsx")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载封号账号(xlsx)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(n,e,"风控账号.txt")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载风控账号(txt)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(c,e,"风控账号.xlsx")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载风控账号(xlsx)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(i,e,"成功账号.txt")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载成功账号(txt)")])),_:2},1032,["onClick"]),Vue.createVNode(b,{onClick:e=>(async e=>{await Y(s,e,"成功账号.xlsx")})(a.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("下载成功账号(xlsx)")])),_:2},1032,["onClick"])])),_:2},1024)])),default:Vue.withCtx((()=>[Vue.createVNode(f,{class:"button-with-icon-right ml-3",type:"primary",link:"",icon:"More"},{default:Vue.withCtx((()=>[Vue.createTextVNode("更多操作")])),_:1})])),_:2},1024)])])),_:1})])),_:1},8,["data"]),Vue.createVNode(ae,{"current-page":B.value,"page-size":D.value,"page-sizes":[10,30,50,100],total:P.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:j,onSizeChange:z},null,8,["current-page","page-size","total"])]),Vue.createVNode(ge,{modelValue:T.value,"onUpdate:modelValue":u[11]||(u[11]=e=>T.value=e),title:"新建任务","before-close":E},{default:Vue.withCtx((()=>[Vue.createVNode(fe,{ref_key:"formRef",ref:G,model:H,rules:K,"label-width":"120px"},{default:Vue.withCtx((()=>[Vue.createVNode(ue,{label:"任务名称",prop:"taskName"},{default:Vue.withCtx((()=>[Vue.createVNode(m,{modelValue:H.taskName,"onUpdate:modelValue":u[5]||(u[5]=e=>H.taskName=e),autocomplete:"off",placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),Vue.createVNode(ue,{label:"国家区号",prop:"country"},{default:Vue.withCtx((()=>[Vue.createVNode(ie,{modelValue:H.country_id,"onUpdate:modelValue":u[6]||(u[6]=e=>H.country_id=e),filterable:"",placeholder:"请选择国家区号",style:{width:"100%"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(le.value,(e=>(Vue.openBlock(),Vue.createBlock(ce,{key:e.ID,label:"".concat(e.code," ").concat(e.name," ").concat(e.dialingCode),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(ue,{label:"并发数",prop:"concurrency"},{default:Vue.withCtx((()=>[Vue.createVNode(m,{modelValue:H.concurrency,"onUpdate:modelValue":u[7]||(u[7]=e=>H.concurrency=e),modelModifiers:{number:!0},type:"number",placeholder:"并发数",min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"]),Vue.createElementVNode("span",k,"当前可用并发数"+Vue.toDisplayString(F.value.concurrencyLimit-F.value.currentConcurrency),1),Vue.createVNode(de,{class:Vue.normalizeClass(["mt-2 cursor-pointer",{rotate:S.value}]),style:{"margin-left":"4px"},size:12,onClick:u[8]||(u[8]=e=>A())},{default:Vue.withCtx((()=>[Vue.createVNode(se)])),_:1},8,["class"])])),_:1}),Vue.createVNode(me,null,{default:Vue.withCtx((()=>[Vue.createVNode(Ve,null,{default:Vue.withCtx((()=>[Vue.createVNode(ue,{label:"标签"},{default:Vue.withCtx((()=>[Vue.createVNode(ie,{modelValue:H.tag_id,"onUpdate:modelValue":u[9]||(u[9]=e=>H.tag_id=e),class:"w-full",placeholder:"请选择标签"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(te.value,(e=>(Vue.openBlock(),Vue.createBlock(ce,{key:e.ID,label:e.name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(me,null,{default:Vue.withCtx((()=>[Vue.createVNode(Ve,null,{default:Vue.withCtx((()=>[Vue.createVNode(ue,{label:"分组"},{default:Vue.withCtx((()=>[Vue.createVNode(ie,{modelValue:H.group_id,"onUpdate:modelValue":u[10]||(u[10]=e=>H.group_id=e),class:"w-full",placeholder:"请选择分组"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Z.value,(e=>(Vue.openBlock(),Vue.createBlock(ce,{key:e.ID,label:e.name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(me,{gutter:20}),Vue.createVNode(ue,{label:"上传文件",prop:"file"},{default:Vue.withCtx((()=>[Vue.createVNode(pe,{class:"upload-demo","file-list":W.value,"on-change":$,"before-upload":()=>!1},{default:Vue.withCtx((()=>[Vue.createVNode(f,{slot:"trigger"},{default:Vue.withCtx((()=>[Vue.createTextVNode("选择文件")])),_:1})])),_:1},8,["file-list"]),H.file?(Vue.openBlock(),Vue.createElementBlock("div",_,Vue.toDisplayString(H.file.name),1)):Vue.createCommentVNode("",!0)])),_:1}),Vue.createVNode(ue,null,{default:Vue.withCtx((()=>[Vue.createVNode(f,{type:"primary",icon:"Position",class:"w-[7rem] rounded",onClick:Q},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 提交 ")])),_:1}),Vue.createVNode(f,{icon:"RefreshLeft",class:"w-[7rem] rounded",onClick:X},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}});export{b as default};
