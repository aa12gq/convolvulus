/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{i as e,j as t,k as a}from"./index-e8818864.js";import{u as o}from"./authority-268926bd.js";import{g as u,s as l}from"./authorityBtn-58ed1ba1.js";import{_ as r}from"./_plugin-vue_export-helper-1b428a4d.js";import"./.pnpm-8206d43d.js";import"vue";const n={class:"sticky top-0.5 z-10 bg-white"},d={class:"tree-content clear-both"},s={class:"custom-tree-node"},c={key:0},i={class:"dialog-footer"},V=r(Object.assign({name:"Menus"},{__name:"menus",props:{row:{default:function(){return{}},type:Object}},emits:["changeRow"],setup(r,{expose:V,emit:m}){const p=r,h=Vue.ref(""),f=Vue.ref([]),y=Vue.ref([]),w=Vue.ref(!1),v=Vue.ref({children:"children",label:function(e){return e.meta.title}});(async()=>{const a=await e();f.value=a.data.menus;const o=(await t({authorityId:p.row.authorityId})).data.menus,u=[];o.forEach((e=>{o.some((t=>t.parentId===e.menuId))||u.push(Number(e.menuId))})),y.value=u})();const k=()=>{w.value=!0},N=Vue.ref(null),C=async()=>{const e=N.value.getCheckedNodes(!1,!0);0===(await a({menus:e,authorityId:p.row.authorityId})).code&&ElementPlus.ElMessage({type:"success",message:"菜单设置成功!"})};V({enterAndNext:()=>{C()},needConfirm:w});const g=Vue.ref(!1),x=Vue.ref([]),I=Vue.ref([]),b=Vue.ref();let E="";const _=e=>{I.value=e},D=e=>{g.value=!0,x.value=e.menuBtn},R=()=>{g.value=!1},j=async()=>{const e=I.value.map((e=>e.ID));0===(await l({menuID:E,selected:e,authorityId:p.row.authorityId})).code&&(ElementPlus.ElMessage({type:"success",message:"设置成功"}),g.value=!1)},T=(e,t)=>!e||-1!==t.meta.title.indexOf(e);return Vue.watch(h,(e=>{N.value.filter(e)})),(e,t)=>{const a=Vue.resolveComponent("el-input"),l=Vue.resolveComponent("el-button"),V=Vue.resolveComponent("el-tree"),w=Vue.resolveComponent("el-table-column"),I=Vue.resolveComponent("el-table"),B=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",n,[Vue.createVNode(a,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),class:"w-3/5",placeholder:"筛选"},null,8,["modelValue"]),Vue.createVNode(l,{class:"float-right",type:"primary",onClick:C},{default:Vue.withCtx((()=>[Vue.createTextVNode("确 定")])),_:1})]),Vue.createElementVNode("div",d,[Vue.createVNode(V,{ref_key:"menuTree",ref:N,data:f.value,"default-checked-keys":y.value,props:v.value,"default-expand-all":"","highlight-current":"","node-key":"ID","show-checkbox":"","filter-node-method":T,onCheck:k},{default:Vue.withCtx((({node:e,data:t})=>[Vue.createElementVNode("span",s,[Vue.createElementVNode("span",null,Vue.toDisplayString(e.label),1),Vue.createElementVNode("span",null,[Vue.createVNode(l,{type:"primary",link:"",style:Vue.normalizeStyle({color:r.row.defaultRouter===t.name?"#E6A23C":"#85ce61"}),disabled:!e.checked,onClick:()=>(async e=>{const t=await o({authorityId:p.row.authorityId,AuthorityName:p.row.authorityName,parentId:p.row.parentId,defaultRouter:e.name});0===t.code&&(ElementPlus.ElMessage({type:"success",message:"设置成功"}),m("changeRow","defaultRouter",t.data.authority.defaultRouter))})(t)},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(r.row.defaultRouter===t.name?"首页":"设为首页"),1)])),_:2},1032,["style","disabled","onClick"])]),t.menuBtn.length?(Vue.openBlock(),Vue.createElementBlock("span",c,[Vue.createVNode(l,{type:"primary",link:"",onClick:()=>(async e=>{E=e.ID;const t=await u({menuID:E,authorityId:p.row.authorityId});0===t.code&&(D(e),await Vue.nextTick(),t.data.selected&&t.data.selected.forEach((e=>{x.value.some((t=>{t.ID===e&&b.value.toggleRowSelection(t,!0)}))})))})(t)},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 分配按钮 ")])),_:2},1032,["onClick"])])):Vue.createCommentVNode("",!0)])])),_:1},8,["data","default-checked-keys","props"])]),Vue.createVNode(B,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),title:"分配按钮","destroy-on-close":""},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",i,[Vue.createVNode(l,{onClick:R},{default:Vue.withCtx((()=>[Vue.createTextVNode("取 消")])),_:1}),Vue.createVNode(l,{type:"primary",onClick:j},{default:Vue.withCtx((()=>[Vue.createTextVNode("确 定")])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(I,{ref_key:"btnTableRef",ref:b,data:x.value,"row-key":"ID",onSelectionChange:_},{default:Vue.withCtx((()=>[Vue.createVNode(w,{type:"selection",width:"55"}),Vue.createVNode(w,{label:"按钮名称",prop:"name"}),Vue.createVNode(w,{label:"按钮备注",prop:"desc"})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1baa3907"]]);export{V as default};
