/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{g as e,d as t,c as a,u,a as l}from"./authority-268926bd.js";import o from"./menus-99a7a6a1.js";import r from"./apis-01dd7bcc.js";import i from"./datas-cac637bf.js";import{W as d}from"./warningBar-4e9b9d77.js";import"./index-e8818864.js";import"./.pnpm-8206d43d.js";import"vue";import"./authorityBtn-58ed1ba1.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./api-ac1f37dc.js";const n={class:"authority"},V={class:"gva-table-box"},s={class:"gva-btn-list"},c={class:"dialog-footer"},h=Object.assign({name:"Authority"},{__name:"authority",setup(h){const m=Vue.ref([{authorityId:0,authorityName:"根角色"}]),v=Vue.ref(!1),p=Vue.ref("add"),y=Vue.ref({}),f=Vue.ref("新增角色"),N=Vue.ref(!1),w=Vue.ref(!1),C=Vue.ref({}),I=Vue.ref({authorityId:0,authorityName:"",parentId:0}),g=Vue.ref({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,t,a)=>/^[0-9]*[1-9][0-9]*$/.test(t)?a():a(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),x=Vue.ref(1),b=Vue.ref(0),k=Vue.ref(999),_=Vue.ref([]),E=Vue.ref({}),j=async()=>{const t=await e({page:x.value,pageSize:k.value,...E.value});0===t.code&&(_.value=t.data.list,b.value=t.data.total,x.value=t.data.page,k.value=t.data.pageSize)};j();const T=(e,t)=>{y.value[e]=t},B=Vue.ref(null),P=Vue.ref(null),A=Vue.ref(null),M=(e,t)=>{const a=[B,P,A];t&&a[t].value.needConfirm&&(a[t].value.enterAndNext(),a[t].value.needConfirm=!1)},U=Vue.ref(null),q=()=>{U.value&&U.value.resetFields(),I.value={authorityId:0,authorityName:"",parentId:0}},S=()=>{q(),N.value=!1,w.value=!1},z=()=>{U.value.validate((async e=>{if(e){switch(I.value.authorityId=Number(I.value.authorityId),p.value){case"add":0===(await l(I.value)).code&&(ElementPlus.ElMessage({type:"success",message:"添加成功!"}),j(),S());break;case"edit":0===(await u(I.value)).code&&(ElementPlus.ElMessage({type:"success",message:"添加成功!"}),j(),S());break;case"copy":{const e={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};e.authority.authorityId=I.value.authorityId,e.authority.authorityName=I.value.authorityName,e.authority.parentId=I.value.parentId,e.authority.dataAuthorityId=C.value.dataAuthorityId,e.oldAuthorityId=C.value.authorityId;0===(await a(e)).code&&(ElementPlus.ElMessage({type:"success",message:"复制成功！"}),j())}}q(),N.value=!1}}))},D=()=>{m.value=[{authorityId:0,authorityName:"根角色"}],R(_.value,m.value,!1)},R=(e,t,a)=>{I.value.authorityId=String(I.value.authorityId),e&&e.forEach((e=>{if(e.children&&e.children.length){const u={authorityId:e.authorityId,authorityName:e.authorityName,disabled:a||e.authorityId===I.value.authorityId,children:[]};R(e.children,u.children,a||e.authorityId===I.value.authorityId),t.push(u)}else{const u={authorityId:e.authorityId,authorityName:e.authorityName,disabled:a||e.authorityId===I.value.authorityId};t.push(u)}}))},F=e=>{q(),f.value="新增角色",p.value="add",I.value.parentId=e,D(),N.value=!0};return(e,a)=>{const u=Vue.resolveComponent("el-button"),l=Vue.resolveComponent("el-table-column"),h=Vue.resolveComponent("el-table"),w=Vue.resolveComponent("el-cascader"),b=Vue.resolveComponent("el-form-item"),k=Vue.resolveComponent("el-input"),E=Vue.resolveComponent("el-form"),q=Vue.resolveComponent("el-dialog"),R=Vue.resolveComponent("el-tab-pane"),G=Vue.resolveComponent("el-tabs"),H=Vue.resolveComponent("el-drawer");return Vue.openBlock(),Vue.createElementBlock("div",n,[Vue.createVNode(d,{title:"注：右上角头像下拉可切换角色"}),Vue.createElementVNode("div",V,[Vue.createElementVNode("div",s,[Vue.createVNode(u,{type:"primary",icon:"plus",onClick:a[0]||(a[0]=e=>F(0))},{default:Vue.withCtx((()=>[Vue.createTextVNode("新增角色")])),_:1})]),Vue.createVNode(h,{data:_.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:Vue.withCtx((()=>[Vue.createVNode(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),Vue.createVNode(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),Vue.createVNode(l,{align:"left",label:"操作",width:"460"},{default:Vue.withCtx((e=>[Vue.createVNode(u,{icon:"setting",type:"primary",link:"",onClick:t=>{return a=e.row,v.value=!0,void(y.value=a);var a}},{default:Vue.withCtx((()=>[Vue.createTextVNode("设置权限")])),_:2},1032,["onClick"]),Vue.createVNode(u,{icon:"plus",type:"primary",link:"",onClick:t=>F(e.row.authorityId)},{default:Vue.withCtx((()=>[Vue.createTextVNode("新增子角色")])),_:2},1032,["onClick"]),Vue.createVNode(u,{icon:"copy-document",type:"primary",link:"",onClick:t=>(e=>{D(),f.value="拷贝角色",p.value="copy";for(const t in I.value)I.value[t]=e[t];C.value=e,N.value=!0})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("拷贝")])),_:2},1032,["onClick"]),Vue.createVNode(u,{icon:"edit",type:"primary",link:"",onClick:t=>(e=>{D(),f.value="编辑角色",p.value="edit";for(const t in I.value)I.value[t]=e[t];D(),N.value=!0})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("编辑")])),_:2},1032,["onClick"]),Vue.createVNode(u,{icon:"delete",type:"primary",link:"",onClick:a=>{return u=e.row,void ElementPlus.ElMessageBox.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await t({authorityId:u.authorityId})).code&&(ElementPlus.ElMessage({type:"success",message:"删除成功!"}),1===_.value.length&&x.value>1&&x.value--,j())})).catch((()=>{ElementPlus.ElMessage({type:"info",message:"已取消删除"})}));var u}},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),Vue.createVNode(q,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=e=>N.value=e),title:f.value},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",c,[Vue.createVNode(u,{onClick:S},{default:Vue.withCtx((()=>[Vue.createTextVNode("取 消")])),_:1}),Vue.createVNode(u,{type:"primary",onClick:z},{default:Vue.withCtx((()=>[Vue.createTextVNode("确 定")])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(E,{ref_key:"authorityForm",ref:U,model:I.value,rules:g.value,"label-width":"80px"},{default:Vue.withCtx((()=>[Vue.createVNode(b,{label:"父级角色",prop:"parentId"},{default:Vue.withCtx((()=>[Vue.createVNode(w,{modelValue:I.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.parentId=e),style:{width:"100%"},disabled:"add"===p.value,options:m.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),Vue.createVNode(b,{label:"角色ID",prop:"authorityId"},{default:Vue.withCtx((()=>[Vue.createVNode(k,{modelValue:I.value.authorityId,"onUpdate:modelValue":a[2]||(a[2]=e=>I.value.authorityId=e),disabled:"edit"===p.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),Vue.createVNode(b,{label:"角色姓名",prop:"authorityName"},{default:Vue.withCtx((()=>[Vue.createVNode(k,{modelValue:I.value.authorityName,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),v.value?(Vue.openBlock(),Vue.createBlock(H,{key:0,modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:Vue.withCtx((()=>[Vue.createVNode(G,{"before-leave":M,type:"border-card"},{default:Vue.withCtx((()=>[Vue.createVNode(R,{label:"角色菜单"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{ref_key:"menus",ref:B,row:y.value,onChangeRow:T},null,8,["row"])])),_:1}),Vue.createVNode(R,{label:"角色api"},{default:Vue.withCtx((()=>[Vue.createVNode(r,{ref_key:"apis",ref:P,row:y.value,onChangeRow:T},null,8,["row"])])),_:1}),Vue.createVNode(R,{label:"资源权限"},{default:Vue.withCtx((()=>[Vue.createVNode(i,{ref_key:"datas",ref:A,authority:_.value,row:y.value,onChangeRow:T},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):Vue.createCommentVNode("",!0)])}}});export{h as default};
