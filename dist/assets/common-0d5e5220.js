/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{s as e,u as t}from"./index-e8818864.js";import{_ as o}from"./_plugin-vue_export-helper-1b428a4d.js";const a=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),s=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),l=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class n{constructor(e,t,o=1920){this.file=e,this.fileSize=t,this.maxWH=o}compress(){const e=this.file.type;this.file.size;return new Promise((t=>{const o=new FileReader;o.readAsDataURL(this.file),o.onload=()=>{const a=document.createElement("canvas"),s=document.createElement("img");s.src=o.result,s.onload=()=>{const o=a.getContext("2d"),l=this.dWH(s.width,s.height,this.maxWH);a.width=l.width,a.height=l.height,o.clearRect(0,0,a.width,a.height),o.drawImage(s,0,0,a.width,a.height);const n=a.toDataURL(e,.9);this.fileSizeKB(n);this.fileSize;const i=this.dataURLtoBlob(n,e),r=new File([i],this.file.name);t(r)}}}))}dWH(e,t,o){const a={width:e,height:t};return Math.max(e,t)>o?e>t?(a.width=o,a.height=Math.round(t*(o/e)),a):(a.height=o,a.width=Math.round(e*(o/t)),a):a}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const o=atob(e.split(",")[1]);let a=e.split(",")[0].split(":")[1].split(";")[0];const s=new ArrayBuffer(o.length),l=new Uint8Array(s);for(let n=0;n<o.length;n++)l[n]=o.charCodeAt(n);return t&&(a=t),new Blob([s],{type:a,lastModifiedDate:new Date})}}const i=e=>e&&"http"!==e.slice(0,4)?"/api/"+e:e,r=e=>e.endsWith(".mp4")||e.endsWith(".mov")||e.endsWith(".webm")||e.endsWith(".ogg"),u=o(Object.assign({name:"UploadImage"},{__name:"image",props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:o}){const a=e,s=Vue.ref("/api"),l=t(),i=e=>{const t="image/jpeg"===e.type,o="image/png"===e.type;if(!t&&!o)return ElementPlus.ElMessage.error("上传头像图片只能是 jpg或png 格式!"),!1;const s=e.size/1024<a.fileSize;if(!s){return new n(e,a.fileSize,a.maxWH).compress()}return s},r=e=>{const{data:t}=e;t.file&&o("on-success",t.file.url)};return(e,t)=>{const o=Vue.resolveComponent("el-button"),a=Vue.resolveComponent("el-upload");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(a,{action:"".concat(s.value,"/fileUploadAndDownload/upload"),headers:{"x-token":Vue.unref(l).token},"show-file-list":!1,"on-success":r,"before-upload":i,multiple:!1},{default:Vue.withCtx((()=>[Vue.createVNode(o,{type:"primary"},{default:Vue.withCtx((()=>[Vue.createTextVNode("压缩上传")])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-25e77e3f"]]),d=Object.assign({name:"UploadCommon"},{__name:"common",emits:["on-success"],setup(e,{emit:o}){const a=Vue.ref("/api"),s=t(),l=Vue.ref(!1),n=e=>{l.value=!0;const t=e.size/1024/1024<.5,o=e.size/1024/1024<5,a="video/mp4"==(s=e.type)||"video/webm"==s||"video/ogg"==s;var s;const n=(e=>"image/jpeg"==e||"image/png"==e||"image/webp"==e||"image/svg+xml"==e)(e.type);let i=!0;return a||n||(ElementPlus.ElMessage.error("上传图片只能是 jpg,png,svg,webp 格式, 上传视频只能是 mp4,webm 格式!"),l.value=!1,i=!1),!o&&a&&(ElementPlus.ElMessage.error("上传视频大小不能超过 5MB"),l.value=!1,i=!1),!t&&n&&(ElementPlus.ElMessage.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),l.value=!1,i=!1),i},i=e=>{const{data:t}=e;t.file&&o("on-success",t.file.url)},r=()=>{ElementPlus.ElMessage({type:"error",message:"上传失败"}),l.value=!1};return(e,t)=>{const o=Vue.resolveComponent("el-button"),l=Vue.resolveComponent("el-upload");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(l,{action:"".concat(a.value,"/fileUploadAndDownload/upload"),"before-upload":n,headers:{"x-token":Vue.unref(s).token},"on-error":r,"on-success":i,"show-file-list":!1,class:"upload-btn"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{type:"primary"},{default:Vue.withCtx((()=>[Vue.createTextVNode("普通上传")])),_:1})])),_:1},8,["action","headers"])])}}});export{u as U,d as _,i as a,s as d,l as e,a as g,r as i};
