/*! 
 Build based on gin-vue-admin 
 Time : 1705391497000 */
import{g as e,d as a,f as l,a as t,u,c as o,b as r}from"./api-ac1f37dc.js";import{t as d}from"./stringFun-647a78e9.js";import{W as V}from"./warningBar-4e9b9d77.js";import{_ as i}from"./_plugin-vue_export-helper-1b428a4d.js";import"./index-e8818864.js";import"./.pnpm-8206d43d.js";import"vue";const n=e=>(Vue.pushScopeId("data-v-c59b6e67"),e=e(),Vue.popScopeId(),e),c={class:"gva-search-box"},p={class:"gva-table-box"},s={class:"gva-btn-list"},m=n((()=>Vue.createElementVNode("p",null,"确定要删除吗？",-1))),v={style:{"text-align":"right","margin-top":"8px"}},h=n((()=>Vue.createElementVNode("p",null,"确定要刷新Casbin缓存吗？",-1))),f={style:{"text-align":"right","margin-top":"8px"}},g={class:"gva-pagination"},C={class:"dialog-footer"},N=i(Object.assign({name:"Api"},{__name:"api",setup(i){const n=e=>{const a=x.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},N=Vue.ref([]),w=Vue.ref({path:"",apiGroup:"",method:"",description:""}),x=Vue.ref([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),b=Vue.ref(""),y=Vue.ref({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),_=Vue.ref(1),k=Vue.ref(0),E=Vue.ref(10),T=Vue.ref([]),B=Vue.ref({}),P=()=>{B.value={}},A=()=>{_.value=1,E.value=10,S()},I=e=>{E.value=e,S()},U=e=>{_.value=e,S()},G=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),B.value.orderKey=d(e),B.value.desc="descending"===a),S()},S=async()=>{const a=await e({page:_.value,pageSize:E.value,...B.value});0===a.code&&(T.value=a.data.list,k.value=a.data.total,_.value=a.data.page,E.value=a.data.pageSize)};S();const j=e=>{N.value=e},z=Vue.ref(!1),D=async()=>{const e=N.value.map((e=>e.ID)),l=await a({ids:e});0===l.code&&(ElementPlus.ElMessage({type:"success",message:l.msg}),T.value.length===e.length&&_.value>1&&_.value--,z.value=!1,S())},M=Vue.ref(!1),F=async()=>{const e=await l();0===e.code&&ElementPlus.ElMessage({type:"success",message:e.msg}),M.value=!1},q=Vue.ref(null),L=Vue.ref("新增Api"),O=Vue.ref(!1),K=e=>{switch(e){case"addApi":L.value="新增Api";break;case"edit":L.value="编辑Api"}b.value=e,O.value=!0},R=()=>{q.value.resetFields(),w.value={path:"",apiGroup:"",method:"",description:""},O.value=!1},W=async()=>{q.value.validate((async e=>{if(e)switch(b.value){case"addApi":0===(await o(w.value)).code&&ElementPlus.ElMessage({type:"success",message:"添加成功",showClose:!0}),S(),R();break;case"edit":0===(await u(w.value)).code&&ElementPlus.ElMessage({type:"success",message:"编辑成功",showClose:!0}),S(),R();break;default:ElementPlus.ElMessage({type:"error",message:"未知操作",showClose:!0})}}))};return(e,a)=>{const l=Vue.resolveComponent("el-input"),u=Vue.resolveComponent("el-form-item"),o=Vue.resolveComponent("el-option"),d=Vue.resolveComponent("el-select"),i=Vue.resolveComponent("el-button"),b=Vue.resolveComponent("el-form"),H=Vue.resolveComponent("el-popover"),J=Vue.resolveComponent("el-table-column"),Q=Vue.resolveComponent("el-table"),X=Vue.resolveComponent("el-pagination"),Y=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",c,[Vue.createVNode(b,{ref:"searchForm",inline:!0,model:B.value},{default:Vue.withCtx((()=>[Vue.createVNode(u,{label:"路径"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:B.value.path,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"描述"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:B.value.description,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"API组"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:B.value.apiGroup,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"请求"},{default:Vue.withCtx((()=>[Vue.createVNode(d,{modelValue:B.value.method,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.method=e),clearable:"",placeholder:"请选择"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(x.value,(e=>(Vue.openBlock(),Vue.createBlock(o,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(u,null,{default:Vue.withCtx((()=>[Vue.createVNode(i,{type:"primary",icon:"search",onClick:A},{default:Vue.withCtx((()=>[Vue.createTextVNode("查询")])),_:1}),Vue.createVNode(i,{icon:"refresh",onClick:P},{default:Vue.withCtx((()=>[Vue.createTextVNode("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),Vue.createElementVNode("div",p,[Vue.createElementVNode("div",s,[Vue.createVNode(i,{type:"primary",icon:"plus",onClick:a[4]||(a[4]=e=>K("addApi"))},{default:Vue.withCtx((()=>[Vue.createTextVNode("新增")])),_:1}),Vue.createVNode(H,{modelValue:z.value,"onUpdate:modelValue":a[7]||(a[7]=e=>z.value=e),placement:"top",width:"160"},{reference:Vue.withCtx((()=>[Vue.createVNode(i,{icon:"delete",disabled:!N.value.length,onClick:a[6]||(a[6]=e=>z.value=!0)},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:1},8,["disabled"])])),default:Vue.withCtx((()=>[m,Vue.createElementVNode("div",v,[Vue.createVNode(i,{type:"primary",link:"",onClick:a[5]||(a[5]=e=>z.value=!1)},{default:Vue.withCtx((()=>[Vue.createTextVNode("取消")])),_:1}),Vue.createVNode(i,{type:"primary",onClick:D},{default:Vue.withCtx((()=>[Vue.createTextVNode("确定")])),_:1})])])),_:1},8,["modelValue"]),Vue.createVNode(H,{modelValue:M.value,"onUpdate:modelValue":a[10]||(a[10]=e=>M.value=e),placement:"top",width:"160"},{reference:Vue.withCtx((()=>[Vue.createVNode(i,{icon:"Refresh",onClick:a[9]||(a[9]=e=>M.value=!0)},{default:Vue.withCtx((()=>[Vue.createTextVNode("刷新缓存")])),_:1})])),default:Vue.withCtx((()=>[h,Vue.createElementVNode("div",f,[Vue.createVNode(i,{type:"primary",link:"",onClick:a[8]||(a[8]=e=>M.value=!1)},{default:Vue.withCtx((()=>[Vue.createTextVNode("取消")])),_:1}),Vue.createVNode(i,{type:"primary",onClick:F},{default:Vue.withCtx((()=>[Vue.createTextVNode("确定")])),_:1})])])),_:1},8,["modelValue"])]),Vue.createVNode(Q,{data:T.value,onSortChange:G,onSelectionChange:j},{default:Vue.withCtx((()=>[Vue.createVNode(J,{type:"selection",width:"55"}),Vue.createVNode(J,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),Vue.createVNode(J,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),Vue.createVNode(J,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),Vue.createVNode(J,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),Vue.createVNode(J,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:Vue.withCtx((e=>[Vue.createElementVNode("div",null,Vue.toDisplayString(e.row.method)+" / "+Vue.toDisplayString(n(e.row.method)),1)])),_:1}),Vue.createVNode(J,{align:"left",fixed:"right",label:"操作",width:"200"},{default:Vue.withCtx((e=>[Vue.createVNode(i,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await t({id:e.ID});w.value=a.data.api,K("edit")})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("编辑")])),_:2},1032,["onClick"]),Vue.createVNode(i,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{ElementPlus.ElMessageBox.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await r(e)).code&&(ElementPlus.ElMessage({type:"success",message:"删除成功!"}),1===T.value.length&&_.value>1&&_.value--,S())}))})(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),Vue.createElementVNode("div",g,[Vue.createVNode(X,{"current-page":_.value,"page-size":E.value,"page-sizes":[10,30,50,100],total:k.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:U,onSizeChange:I},null,8,["current-page","page-size","total"])])]),Vue.createVNode(Y,{modelValue:O.value,"onUpdate:modelValue":a[15]||(a[15]=e=>O.value=e),"before-close":R,title:L.value},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",C,[Vue.createVNode(i,{onClick:R},{default:Vue.withCtx((()=>[Vue.createTextVNode("取 消")])),_:1}),Vue.createVNode(i,{type:"primary",onClick:W},{default:Vue.withCtx((()=>[Vue.createTextVNode("确 定")])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(V,{title:"新增API，需要在角色管理内配置权限才可使用"}),Vue.createVNode(b,{ref_key:"apiForm",ref:q,model:w.value,rules:y.value,"label-width":"80px"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{label:"路径",prop:"path"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:w.value.path,"onUpdate:modelValue":a[11]||(a[11]=e=>w.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"请求",prop:"method"},{default:Vue.withCtx((()=>[Vue.createVNode(d,{modelValue:w.value.method,"onUpdate:modelValue":a[12]||(a[12]=e=>w.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(x.value,(e=>(Vue.openBlock(),Vue.createBlock(o,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"api分组",prop:"apiGroup"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:w.value.apiGroup,"onUpdate:modelValue":a[13]||(a[13]=e=>w.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),Vue.createVNode(u,{label:"api简介",prop:"description"},{default:Vue.withCtx((()=>[Vue.createVNode(l,{modelValue:w.value.description,"onUpdate:modelValue":a[14]||(a[14]=e=>w.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-c59b6e67"]]);export{N as default};
